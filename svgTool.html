<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>PNG → SVG Tracer</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      background: #0f0f15;
      color: #e0e0ff;
      padding: 20px;
      max-width: 1100px;
      margin: 0 auto;
    }
    h1 { color: #a5b4fc; }
    .container {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
      margin: 24px 0;
    }
    .panel {
      background: #1a1a2e;
      padding: 20px;
      border-radius: 12px;
      border: 1px solid #333366;
    }
    canvas, svg {
      max-width: 100%;
      height: auto;
      background: #00000022;
      border: 1px solid #444;
      border-radius: 6px;
    }
    .controls {
      display: flex;
      flex-wrap: wrap;
      gap: 16px;
      margin: 16px 0;
    }
    button {
      padding: 10px 18px;
      background: #6366f1;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 1rem;
    }
    button:hover { background: #818cf8; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    label { display: block; margin: 12px 0 4px; }
    input[type=range] { width: 180px; }
    .info { font-size: 0.9rem; color: #aaa; }
  </style>
</head>
<body>

<h1>PNG → SVG (browser tracing)</h1>

<div class="container">
  <div class="panel">
    <h2>1. Load PNG</h2>
    <input type="file" id="fileInput" accept="image/png,image/jpeg" />
    <p class="info">Best results with clean logos, icons, line art, silhouettes (black & white works best)</p>

    <h3>Preview</h3>
    <canvas id="canvas" width="500" height="500"></canvas>
  </div>

  <div class="panel">
    <h2>2. Trace → SVG</h2>

    <div class="controls">
      <button id="traceBtn" disabled>Convert to SVG</button>
      <button id="downloadBtn" disabled>Download SVG</button>
    </div>

    <label>Threshold (0–255): <span id="threshVal">128</span></label>
    <input type="range" id="threshold" min="0" max="255" value="128" step="1" />

    <label>Blur (smoothing): <span id="blurVal">1.5</span> px</label>
    <input type="range" id="blur" min="0" max="5" value="1.5" step="0.1" />

    <label>Min path length: <span id="lenVal">8</span> px</label>
    <input type="range" id="minLength" min="2" max="30" value="8" step="1" />

    <label>Turn policy: <select id="turnPolicy">
      <option value="black">black (default – good for most cases)</option>
      <option value="white">white</option>
      <option value="left">left</option>
      <option value="right">right</option>
      <option value="majority">majority</option>
      <option value="minority">minority</option>
    </select></label>

    <h3>Result SVG</h3>
    <div id="svgContainer"></div>
  </div>
</div>

<script src="https://unpkg.com/potrace@2.1.8/dist/potrace-browser.min.js"></script>

<script>
// ────────────────────────────────────────────────
const fileInput   = document.getElementById('fileInput');
const canvas      = document.getElementById('canvas');
const ctx         = canvas.getContext('2d');
const traceBtn    = document.getElementById('traceBtn');
const downloadBtn = document.getElementById('downloadBtn');
const svgContainer = document.getElementById('svgContainer');

let originalImage = null;

// UI elements
const threshSlider = document.getElementById('threshold');
const threshVal    = document.getElementById('threshVal');
const blurSlider   = document.getElementById('blur');
const blurVal      = document.getElementById('blurVal');
const lenSlider    = document.getElementById('minLength');
const lenVal       = document.getElementById('lenVal');

threshSlider.oninput = () => threshVal.textContent = threshSlider.value;
blurSlider.oninput   = () => blurVal.textContent   = blurSlider.value;
lenSlider.oninput    = () => lenVal.textContent    = lenSlider.value;

// ────────────────────────────────────────────────
fileInput.onchange = e => {
  const file = e.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = ev => {
    const img = new Image();
    img.onload = () => {
      originalImage = img;

      // fit to canvas
      const max = 500;
      let w = img.width, h = img.height;
      if (w > h) {
        if (w > max) { h *= max/w; w = max; }
      } else {
        if (h > max) { w *= max/h; h = max; }
      }

      canvas.width = w;
      canvas.height = h;
      ctx.drawImage(img, 0, 0, w, h);

      traceBtn.disabled = false;
      downloadBtn.disabled = true;
      svgContainer.innerHTML = '';
    };
    img.src = ev.target.result;
  };
  reader.readAsDataURL(file);
};

// ────────────────────────────────────────────────
traceBtn.onclick = () => {
  if (!originalImage) return;

  // 1. Draw image again (in case canvas was resized etc)
  ctx.drawImage(originalImage, 0, 0, canvas.width, canvas.height);

  // 2. Optional: slight blur → better tracing
  const blur = parseFloat(blurSlider.value);
  if (blur > 0) {
    ctx.filter = `blur(${blur}px)`;
    ctx.drawImage(canvas, 0, 0);
    ctx.filter = 'none';
  }

  // 3. Get image data
  const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height);

  // 4. Trace!
  const traceOptions = {
    turnpolicy:     document.getElementById('turnPolicy').value,
    turdsize:       parseInt(lenSlider.value),
    alphamax:       1.0,           // 0 = no smoothing, 1 = good smoothing, 1.3334 = max
    opticurve:      true,
    opttolerance:   0.2,
    threshold:      parseInt(threshSlider.value) / 255,
    blackonwhite:   true           // most common for logos
  };

  potrace.trace(imageData, traceOptions, (err, svg) => {
    if (err) {
      alert("Tracing failed: " + err);
      return;
    }

    svgContainer.innerHTML = svg;
    downloadBtn.disabled = false;
    downloadBtn.onclick = () => downloadSVG(svg);
  });
};

function downloadSVG(svgString) {
  const blob = new Blob([svgString], {type: 'image/svg+xml'});
  const url = URL.createObjectURL(blob);

  const a = document.createElement('a');
  a.href = url;
  a.download = 'traced-image.svg';
  a.click();

  URL.revokeObjectURL(url);
}
</script>

</body>
</html>
